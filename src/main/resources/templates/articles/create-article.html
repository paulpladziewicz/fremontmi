<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="~{partials/layout :: minimalHead}"></th:block>
    <title>Announcements - FremontMI</title>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/paragraph@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/list@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/image@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/raw@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/quote@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/embed@latest"></script>
</head>

<body>
<header th:insert="~{partials/navbar}"></header>

<div class="container mt-5">
    <div class="row">
        <div class="col-12 mb-4">
            <div id="editorjs" class="announcement-editor"></div>
        </div>
    </div>
    <button id="saveButton" class="btn btn-primary mt-3">Save Content</button>
</div>


<script th:inline="javascript">
    class StyledParagraph {
        static get toolbox() {
            return {
                title: 'Paragraph',
                icon: '<svg>...</svg>' // You can add an icon for the tool
            };
        }

        constructor({ data }) {
            this.data = data;
            this.wrapper = null;
        }

        render() {
            this.wrapper = document.createElement('div');
            const paragraph = document.createElement('p');
            paragraph.contentEditable = true;
            paragraph.innerHTML = this.data.text || '';
            if (this.data.isLead) {
                paragraph.classList.add('lead'); // Add Bootstrap's lead class
            }
            this.wrapper.appendChild(paragraph);

            // Create a button to toggle "lead" class
            const toggleLeadBtn = document.createElement('button');
            toggleLeadBtn.innerText = this.data.isLead ? 'Remove Lead' : 'Make Lead';
            toggleLeadBtn.addEventListener('click', () => {
                paragraph.classList.toggle('lead');
                this.data.isLead = paragraph.classList.contains('lead');
                toggleLeadBtn.innerText = this.data.isLead ? 'Remove Lead' : 'Make Lead';
            });

            this.wrapper.appendChild(toggleLeadBtn);
            return this.wrapper;
        }

        save(blockContent) {
            return {
                text: blockContent.querySelector('p').innerHTML,
                isLead: blockContent.querySelector('p').classList.contains('lead')
            };
        }
    }

    const editor = new EditorJS({
        holder: 'editorjs',
        tools: {
            header: Header,
            paragraph: {
                class: StyledParagraph,
                inlineToolbar: true,
            },
            list: {
                class: List,
                inlineToolbar: true,
                config: {
                    defaultStyle: 'unordered'
                }
            },
            raw: RawTool,
            image: {
                class: ImageTool,
                config: {
                    endpoints: {
                        byFile: 'http://localhost:8008/uploadFile', // Your backend file uploader endpoint
                        byUrl: 'http://localhost:8008/fetchUrl', // Your endpoint that provides uploading by Url
                    }
                }
            },
            quote: Quote,
            embed: {
                class: Embed,
                config: {
                    services: {
                        youtube: true,
                        coub: true
                    }
                }
            },
        }
    })

    document.getElementById('saveButton').addEventListener('click', () => {
        editor.save().then((outputData) => {
            console.log('Article data: ', outputData);
        }).catch((error) => {
            console.error('Saving failed: ', error);
        });
    });
</script>
</body>
</html>
